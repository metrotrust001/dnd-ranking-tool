import{d as N,f as j,a as A}from"../chunks/CExc3cVl.js";import{i as P}from"../chunks/ClNMK2N7.js";import{h as C,$ as z,a3 as o,a1 as E,a2 as H,a6 as V,A as s,a4 as c,L as O,a5 as n}from"../chunks/DNRmIxaC.js";import{s as g}from"../chunks/BwQBvvJE.js";import{i as K}from"../chunks/DHtTtqUK.js";import{d as Q,e as W,i as X}from"../chunks/CwrMK5JR.js";import{t as Y}from"../chunks/BQs9fFl7.js";function Z(i,v,p,l){var d=i.__style;if(C||d!==v){var h=Y(v);(!C||h!==i.getAttribute("style"))&&(h==null?i.removeAttribute("style"):i.style.cssText=h),i.__style=v}return l}var $=j('<div class="result-row svelte-virixh"><span class="rank"> </span> <span class="name svelte-virixh"> </span> <div class="bar-container svelte-virixh"><div class="bar svelte-virixh"></div></div> <span class="points svelte-virixh"> </span></div>'),ee=j('<div class="results-table svelte-virixh"></div>'),te=j('<div class="tally-dashboard svelte-virixh"><h3>Tally Dashboard</h3> <h4>Upload Original Ballot List</h4> <input type="file" accept=".csv"/> <h4>Upload Vote Files</h4> <input type="file" multiple accept=".json"/> <button> </button> <!></div>');function ce(i,v){z(v,!1);let p=O(null),l=O([]),d=O([]);function h(e){const r=new FileReader;r.onload=a=>V(p,a.target.result),r.readAsText(e)}function L(e){const r=new FileReader;r.onload=async a=>{const t=JSON.parse(a.target.result);V(l,[...s(l),t])},r.readAsText(e)}async function M(){if(!s(p))return alert("Upload the original CSV template.");if(s(l).length<3)return alert("Minimum 3 votes required for consensus.");const e={};for(const a of s(l)){console.log(a);const t=await Q(a,s(p));console.log(t),t.split(`
`).forEach(x=>{const[b,u]=x.split(","),m=parseInt(b.trim().replace(/"/g,""),10);e[u]=(e[u]||0)+m})}Object.values(e).reduce((a,t)=>a+t,0);const r=Math.max(...Object.values(e));V(d,Object.entries(e).map(([a,t],_)=>({rank:_+1,name:a,points:t,percentage:(t/r*100).toFixed(1)})).sort((a,t)=>t.points-a.points))}P();var y=te(),F=o(c(y),4);F.__change=e=>h(e.target.files[0]);var S=o(F,4);S.__change=e=>Array.from(e.target.files).forEach(L);var f=o(S,2);f.__click=M;var R=c(f);n(f);var q=o(f,2);{var B=e=>{var r=ee();W(r,5,()=>s(d),X,(a,t)=>{let _=()=>s(t).rank,x=()=>s(t).name,b=()=>s(t).points,u=()=>s(t).percentage;var m=$(),k=c(m),D=c(k);n(k);var w=o(k,2),G=c(w,!0);n(w);var T=o(w,2),I=c(T);n(T);var U=o(T,2),J=c(U);n(U),n(m),E(()=>{g(D,`#${_()??""}`),g(G,x()),Z(I,`width: ${u()??""}%`),g(J,`${b()??""} pts (${u()??""}%)`)}),A(a,m)}),n(r),A(e,r)};K(q,e=>{s(d).length>0&&e(B)})}n(y),E(()=>{f.disabled=s(l).length<3||!s(p),g(R,`Generate Tally (${s(l).length??""}/3 votes)`)}),A(i,y),H()}N(["change","click"]);export{ce as component};
