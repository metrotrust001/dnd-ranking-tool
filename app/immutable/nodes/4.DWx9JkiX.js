import{f as j,a as O}from"../chunks/CX3WrBNQ.js";import{i as N}from"../chunks/DFhP2dWn.js";import{h as U,L as P,M as o,ac as C,O as z,s as V,g as s,ad as c,m as A,ae as l}from"../chunks/DblM_-rn.js";import{s as _}from"../chunks/BDv1WbEl.js";import{i as H}from"../chunks/BgK0tPoo.js";import{d as K,e as Q,i as W}from"../chunks/JPL4CKw9.js";import{d as X}from"../chunks/Bq4bhG-3.js";import{t as Y}from"../chunks/BQs9fFl7.js";import"../chunks/D4D13gv9.js";function Z(n,p,v,i){var d=n.__style;if(U||d!==p){var f=Y(p);(!U||f!==n.getAttribute("style"))&&(f==null?n.removeAttribute("style"):n.style.cssText=f),n.__style=p}return i}var $=j('<div class="result-row svelte-virixh"><span class="rank"> </span> <span class="name svelte-virixh"> </span> <div class="bar-container svelte-virixh"><div class="bar svelte-virixh"></div></div> <span class="points svelte-virixh"> </span></div>'),ee=j('<div class="results-table svelte-virixh"></div>'),te=j('<div class="tally-dashboard svelte-virixh"><h3>Tally Dashboard</h3> <h4>Upload Original Ballot List</h4> <input type="file" accept=".csv"/> <h4>Upload Vote Files (minimum 3)</h4> <input type="file" multiple accept=".json"/> <button> </button> <!></div>');function ve(n,p){P(p,!1);let v=A(null),i=A([]),d=A([]);function f(e){const r=new FileReader;r.onload=a=>V(v,a.target.result),r.readAsText(e)}function E(e){const r=new FileReader;r.onload=async a=>{const t=JSON.parse(a.target.result);V(i,[...s(i),t])},r.readAsText(e)}async function L(){if(!s(v))return alert("Upload the original CSV template.");if(s(i).length<3)return alert("Minimum 3 votes required for consensus.");const e={};for(const a of s(i)){console.log(a);const t=await K(a,s(v));console.log(t),t.split(`
`).forEach(x=>{const[b,m]=x.split(","),u=parseInt(b.trim().replace(/"/g,""),10);e[m]=(e[m]||0)+u})}Object.values(e).reduce((a,t)=>a+t,0);const r=Math.max(...Object.values(e));V(d,Object.entries(e).map(([a,t],g)=>({rank:g+1,name:a,points:t,percentage:(t/r*100).toFixed(1)})).sort((a,t)=>t.points-a.points))}N();var y=te(),F=o(c(y),4);F.__change=e=>f(e.target.files[0]);var M=o(F,4);M.__change=e=>Array.from(e.target.files).forEach(E);var h=o(M,2);h.__click=L;var R=c(h);l(h);var q=o(h,2);{var B=e=>{var r=ee();Q(r,5,()=>s(d),W,(a,t)=>{let g=()=>s(t).rank,x=()=>s(t).name,b=()=>s(t).points,m=()=>s(t).percentage;var u=$(),k=c(u),D=c(k);l(k);var w=o(k,2),G=c(w,!0);l(w);var T=o(w,2),I=c(T);l(T);var S=o(T,2),J=c(S);l(S),l(u),C(()=>{_(D,`#${g()??""}`),_(G,x()),Z(I,`width: ${m()??""}%`),_(J,`${b()??""} pts (${m()??""}%)`)}),O(a,u)}),l(r),O(e,r)};H(q,e=>{s(d).length>0&&e(B)})}l(y),C(()=>{h.disabled=s(i).length<3||!s(v),_(R,`Generate Tally (${s(i).length??""} vote file/s uploaded)`)}),O(n,y),z()}X(["change","click"]);export{ve as component};
